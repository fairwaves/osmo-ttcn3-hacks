module IPA_Test {

	import from IPA_CodecPort all;
	import from IPA_CodecPort_CtrlFunct all;
	import from IPL4asp_Types all;

	type component ipa_CT {
		port IPA_CODEC_PT IPA;
		var boolean g_initialized := false;

		var ConnectionId g_ipa_conn_id := -1;
	}

	modulepar {
		PortNumber mp_local_port := 0;
		charstring mp_local_ip := "127.0.0.1";
		PortNumber mp_remote_port := 3002;
		charstring mp_remote_ip := "127.0.0.1";
	}

	private function f_init() runs on ipa_CT {
		var Result res;

		if (g_initialized == true) {
			return;
		}
		g_initialized := true;
		map(self:IPA, system:IPA_CODEC_PT);

		res := IPA_CodecPort_CtrlFunct.f_IPL4_connect(IPA, mp_remote_ip, mp_remote_port,
							mp_local_ip, mp_local_port, 0, { tcp:={} });
		g_ipa_conn_id := res.connId;
	}

	testcase TC_recv_dump() runs on ipa_CT {
		f_init();

		while (true) {
			IPA.receive;
		}
	}

	control {
		execute( TC_recv_dump() );
	}
}
